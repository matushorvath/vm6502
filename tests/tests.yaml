# If you want to run this against stdin:
# echo A | npm run ut -- -stdio
# yq 'map(select(.input)) | map(.input) | .[]' < tests/tests.yaml | npm run ut -- -stdio

- desc: Trivial program
  setup:
    decimal: true
    mem:
      0x0000: |
        CLD
        .byte $02
  check:
    decimal: false

- desc: Load and store address A
  setup:
    mem:
      0x0000: |
        LDA $0400
        LDA $0401
        STA $0402
        .byte $02
      0x400: [0x42, 0x43]
  check:
    mem:
      0x400: [0x42, 0x43, 0x43]
    a: 0x43

- desc: Output
  setup:
    mem:
      0x0000: |
        LDA #$41
        STA $FFF0
        .byte $02
  check:
    a: 0x41
  output: A

- desc: Input
  setup:
    mem:
      0x0000: |
        LDA $FFF0
        .byte $02
  input: A
  check:
    a: 0x41

# ADC
# TODO BCD

- desc: ADC immediate, +/+, no carry, no overflow
  setup:
    mem:
      0x0000: |
        LDA #$01
        ADC #$02
        .byte $02
  check:
    a: 0x03
    # verified

- desc: ADC immediate, -/-, no carry, overflow
  setup:
    mem:
      0x0000: |
        LDA #$FA
        ADC #$FD
        .byte $02
  check:
    a: 0xF7
    negative: true
    carry: true
    # verified

- desc: ADC immediate, +/-, no carry, no overflow
  setup:
    mem:
      0x0000: |
        LDA #$01
        ADC #$FE
        .byte $02
  check:
    a: 0xFF
    negative: true
    # verified

- desc: ADC immediate, -/+, carry, no overflow
  setup:
    mem:
      0x0000: |
        LDA #$FA
        ADC #$18
        .byte $02
  check:
    a: 0x12
    carry: true
    # verified

- desc: ADC immediate, +/+, no carry, overflow
  setup:
    mem:
      0x0000: |
        LDA #$40
        ADC #$40
        .byte $02
  check:
    a: 0x80
    negative: true
    overflow: true
    # verified

- desc: ADC immediate, -/-, no carry, overflow
  setup:
    mem:
      0x0000: |
        LDA #$C0
        ADC #$C0
        .byte $02
  check:
    a: 0x80
    negative: true
    overflow: true
    # verified

# Generated tests for ADC
- desc: ADC 00, 00 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$00
        .byte $02
  check:
    a: 0x00
    zero: true

- desc: ADC 00, 42 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$42
        .byte $02
  check:
    a: 0x42

- desc: ADC 00, 7f -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$7f
        .byte $02
  check:
    a: 0x7f

- desc: ADC 00, 80 -> 80
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$80
        .byte $02
  check:
    a: 0x80
    negative: true

- desc: ADC 00, b6 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$b6
        .byte $02
  check:
    a: 0xb6
    negative: true

- desc: ADC 00, ff -> ff
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$ff
        .byte $02
  check:
    a: 0xff
    negative: true

- desc: ADC 42, 00 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$00
        .byte $02
  check:
    a: 0x42

- desc: ADC 42, 42 -> 84
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$42
        .byte $02
  check:
    a: 0x84
    negative: true
    overflow: true

- desc: ADC 42, 7f -> c1
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$7f
        .byte $02
  check:
    a: 0xc1
    negative: true
    overflow: true

- desc: ADC 42, 80 -> c2
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$80
        .byte $02
  check:
    a: 0xc2
    negative: true

- desc: ADC 42, b6 -> f8
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$b6
        .byte $02
  check:
    a: 0xf8
    negative: true

- desc: ADC 42, ff -> 41
  setup:
    mem:
      0x0000: |
        LDA #$42
        ADC #$ff
        .byte $02
  check:
    a: 0x41
    carry: true

- desc: ADC 7f, 00 -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$00
        .byte $02
  check:
    a: 0x7f
    negative: true
    overflow: true

- desc: ADC 7f, 42 -> c1
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$42
        .byte $02
  check:
    a: 0xc1
    negative: true
    overflow: true

- desc: ADC 7f, 7f -> fe
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$7f
        .byte $02
  check:
    a: 0xfe
    negative: true
    overflow: true

- desc: ADC 7f, 80 -> ff
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$80
        .byte $02
  check:
    a: 0xff
    negative: true

- desc: ADC 7f, b6 -> 35
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$b6
        .byte $02
  check:
    a: 0x35
    carry: true

- desc: ADC 7f, ff -> 7e
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$ff
        .byte $02
  check:
    a: 0x7e
    carry: true

- desc: ADC 80, 00 -> 80
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$00
        .byte $02
  check:
    a: 0x80
    negative: true

- desc: ADC 80, 42 -> c2
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$42
        .byte $02
  check:
    a: 0xc2
    negative: true

- desc: ADC 80, 7f -> ff
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$7f
        .byte $02
  check:
    a: 0xff
    negative: true

- desc: ADC 80, 80 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$80
        .byte $02
  check:
    a: 0x00
    overflow: true
    zero: true
    carry: true

- desc: ADC 80, b6 -> 36
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$b6
        .byte $02
  check:
    a: 0x36
    overflow: true
    carry: true

- desc: ADC 80, ff -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$ff
        .byte $02
  check:
    a: 0x7f
    negative: true
    carry: true

- desc: ADC b6, 00 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$00
        .byte $02
  check:
    a: 0xb6
    negative: true

- desc: ADC b6, 42 -> f8
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$42
        .byte $02
  check:
    a: 0xf8
    negative: true

- desc: ADC b6, 7f -> 35
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$7f
        .byte $02
  check:
    a: 0x35
    carry: true

- desc: ADC b6, 80 -> 36
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$80
        .byte $02
  check:
    a: 0x36
    overflow: true
    carry: true

- desc: ADC b6, b6 -> 6c
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$b6
        .byte $02
  check:
    a: 0x6c
    overflow: true
    carry: true

- desc: ADC b6, ff -> b5
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$ff
        .byte $02
  check:
    a: 0xb5
    negative: true
    carry: true

- desc: ADC ff, 00 -> ff
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$00
        .byte $02
  check:
    a: 0xff
    zero: true
    carry: true

- desc: ADC ff, 42 -> 41
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$42
        .byte $02
  check:
    a: 0x41
    carry: true

- desc: ADC ff, 7f -> 7e
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$7f
        .byte $02
  check:
    a: 0x7e
    carry: true

- desc: ADC ff, 80 -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$80
        .byte $02
  check:
    a: 0x7f
    negative: true
    carry: true

- desc: ADC ff, b6 -> b5
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$b6
        .byte $02
  check:
    a: 0xb5
    negative: true
    carry: true

- desc: ADC ff, ff -> fe
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$ff
        .byte $02
  check:
    a: 0xfe
    negative: true
    carry: true

- desc: ADC 00, 00 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$00
        .byte $02
  check:
    a: 0x00

- desc: ADC 40, c0 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$40
        ADC #$c0
        .byte $02
  check:
    a: 0x00
    zero: true
    carry: true

- desc: ADC b0, 50 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$b0
        ADC #$50
        .byte $02
  check:
    a: 0x00
    carry: true

- desc: ADC 80, 80 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$80
        .byte $02
  check:
    a: 0x00
    overflow: true
    carry: true

- desc: ADC 7f, 81 -> 00
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$81
        .byte $02
  check:
    a: 0x00
    carry: true

- desc: ADC 00, 42 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$42
        .byte $02
  check:
    a: 0x42

- desc: ADC 12, 30 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$12
        ADC #$30
        .byte $02
  check:
    a: 0x42
    overflow: true
    zero: true

- desc: ADC f0, 52 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$f0
        ADC #$52
        .byte $02
  check:
    a: 0x42
    carry: true

- desc: ADC 60, e2 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$60
        ADC #$e2
        .byte $02
  check:
    a: 0x42
    carry: true

- desc: ADC a0, a2 -> 42
  setup:
    mem:
      0x0000: |
        LDA #$a0
        ADC #$a2
        .byte $02
  check:
    a: 0x42
    overflow: true
    carry: true

- desc: ADC 7f, 00 -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$00
        .byte $02
  check:
    a: 0x7f
    negative: true
    overflow: true

- desc: ADC 50, 2f -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$50
        ADC #$2f
        .byte $02
  check:
    a: 0x7f

- desc: ADC ff, 80 -> 7f
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$80
        .byte $02
  check:
    a: 0x7f
    overflow: true
    carry: true

- desc: ADC 80, 00 -> 80
  setup:
    mem:
      0x0000: |
        LDA #$80
        ADC #$00
        .byte $02
  check:
    a: 0x80
    negative: true

- desc: ADC 20, 60 -> 80
  setup:
    mem:
      0x0000: |
        LDA #$20
        ADC #$60
        .byte $02
  check:
    a: 0x80
    negative: true
    overflow: true

- desc: ADC 81, ff -> 80
  setup:
    mem:
      0x0000: |
        LDA #$81
        ADC #$ff
        .byte $02
  check:
    a: 0x80
    negative: true
    carry: true

- desc: ADC 00, b6 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$b6
        .byte $02
  check:
    a: 0xb6
    negative: true

- desc: ADC b6, 00 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$b6
        ADC #$00
        .byte $02
  check:
    a: 0xb6
    negative: true

- desc: ADC 70, 46 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$70
        ADC #$46
        .byte $02
  check:
    a: 0xb6
    negative: true
    overflow: true

- desc: ADC 90, 26 -> b6
  setup:
    mem:
      0x0000: |
        LDA #$90
        ADC #$26
        .byte $02
  check:
    a: 0xb6
    negative: true

- desc: ADC b7, ff -> b6
  setup:
    mem:
      0x0000: |
        LDA #$b7
        ADC #$ff
        .byte $02
  check:
    a: 0xb6
    negative: true
    carry: true

- desc: ADC ff, 00 -> ff
  setup:
    mem:
      0x0000: |
        LDA #$ff
        ADC #$00
        .byte $02
  check:
    a: 0xff
    zero: true
    carry: true

- desc: ADC 00, ff -> ff
  setup:
    mem:
      0x0000: |
        LDA #$00
        ADC #$ff
        .byte $02
  check:
    a: 0xff
    zero: true
    carry: true

- desc: ADC fe, 01 -> ff
  setup:
    mem:
      0x0000: |
        LDA #$fe
        ADC #$01
        .byte $02
  check:
    a: 0xff
    zero: true
    carry: true

- desc: ADC 7f, 80 -> ff
  setup:
    mem:
      0x0000: |
        LDA #$7f
        ADC #$80
        .byte $02
  check:
    a: 0xff
    zero: true
    carry: true

